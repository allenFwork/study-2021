# 项目实战1

## 1. 框架



## 2. 技术

1.调用

微服务底层通过http协议请求

dubbo底层通过rpc协议请求

QQ是用C语言写的，C语言写的可能不支持http协议，所以无法使用传统的http请求，底层使用的是socket进行请求的。

2.进程

不同的进程，无法控制事务

使用锁的机制保护共有资源





## 3. 单点登录











## 4. 第三方登录 (Oautho2.0协议规定)

![](images\第三方登录.png)

1. 客户使用浏览器（客户端）进入百度网盘登陆页面，执行第三方登录（使用QQ/微信/微博登录）

2. 百度网盘会给第三方发送一个登录请求，第三方会给百度网盘返回一个地址

   百度网盘拿到第三方的地址后，会重定向到第三方返回的地址，让用户去登陆第三方

3. 用户进行第三方的登录验证，登录过程中有些参数是必要的：

   - ClientID：表明是什么要进行第三方登录，此处用于表明是百度网盘
   - callback：回调地址，用于记录是从什么地址访问的
   - status code：授权码，只能使用一次，有效期有时间限制

4. 第三方登陆验证完成后，再通过重定向将验证结果告诉百度网盘，重定向时有code和callback信息
5. 百度网盘获取到第三方的结果，百度网盘的服务器直接请求第三方，拿着code换取token:
   - 用获取的code作为参数，获取登录信息
   - 为了保证信息安全，code只能使用一次（百度网盘用了，别人就无法使用了），而且被设置了有效期
   - 在请求第三方的时候，callback作为安全验证，第三方会通过callback判断是不是之前的百度网盘（为了保证信息没有被第三方滥用）
6. 第三方将用户信息进行加密，并且生成一个token返回给百度网盘服务器
   - token必须是加密的，具有安全性
   - token能够携带数据
     - 第三方没有必要存储用户信息（负担过大），只做验证功能
     - 百度网盘可能会使用token去第三方获取用户信息，可能不会
   - token指定过期时间
7. 百度网盘如果需要用到用户信息，就使用token作为参数调用第三发登录获取信息
   
   - 第三方将token进行解密，获取用户信息，然后将此信息返回给百度网盘



## 5. 权限控制

### 5.1 page控制

- 如果权限不够，就看不到这个页面

### 5.2 url控制

- 具体控制到Controller，权限不足

### 5.3 button控制

- 如果权限不足，就干脆不显示这个按钮



前端控制

后台将返回

